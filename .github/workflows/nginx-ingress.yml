name: nginx-ingress CI

on:
  push:
    paths:
    - 'nginx-ingress/**'
    - '.github/workflows/nginx-ingress.yml'
    branches:
      - stable
      - unstable
jobs:
  create-release:
    runs-on: ubuntu-latest
    env: 
      working-directory: ./nginx-ingress
      make-command: make yarg
    steps:
    - uses: actions/checkout@v2
    - name: Display the path
      run: pwd
      shell: bash
      working-directory: ${{env.working-directory}}
    - name: Create a release on Channel associated with the branch
      run: bash -c ${{env.make-command}}
      shell: bash
      working-directory: ${{env.working-directory}}
      env:
        REPLICATED_API_TOKEN: ${{ secrets.REPLICATED_API_TOKEN }}
        REPLICATED_APP: nginx-ingress
    - name: Create a release on Channel associated with the branch
      run: make release
      shell: bash
      working-directory: ${{env.working-directory}}
      env:
        REPLICATED_API_TOKEN: ${{ secrets.REPLICATED_API_TOKEN }}
        REPLICATED_APP: nginx-ingress



